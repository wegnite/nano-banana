# 📋 文档通用化改造方案

## 一、问题分析报告

### 1.1 硬编码内容清单

#### 🔴 严重问题 - 特定项目名称
| 文件 | 行号 | 硬编码内容 | 影响范围 |
|-----|-----|-----------|---------|
| `nextjs15-migration-guide.md` | 6 | Mahavatar Narsimha (MovieIndia) | 项目标识 |
| `nextjs15-migration-guide.md` | 96 | https://mahavatar-narsimha.com | 域名硬编码 |
| `文档索引.md` | 107 | AI Universal Generator Team | 团队名称 |
| `项目架构文档.md` | 385 | AI ShipAny Team | 团队名称 |

#### 🟡 中等问题 - 通用占位符但不够灵活
| 文件 | 位置 | 当前内容 | 问题说明 |
|-----|-----|---------|---------|
| `Creem支付配置指南.md` | 多处 | {{PRODUCTION_DOMAIN}} | 需要配置化 |
| `Creem产品映射更新.md` | 212 | {{PRODUCTION_DOMAIN}} | 需要配置化 |
| `用户归因系统部署指南.md` | 25,51 | {{PRODUCTION_DOMAIN}} | 需要配置化 |

#### 🟢 轻微问题 - 外部依赖
| 文件 | 内容 | 类型 |
|-----|-----|-----|
| `产品需求文档.md` | https://docs.shipany.ai | ShipAny文档链接 |
| `产品需求文档.md` | https://github.com/shipanyai | GitHub仓库 |
| `Claude Agent大全.md` | github.com/wshobson/agents.git | 外部仓库引用 |

### 1.2 文档结构问题

#### 当前问题
1. **混合语言命名**：部分文档使用英文命名（如 `development-checklist.md`）
2. **分类不清晰**：技术文档、产品文档、配置指南混在一起
3. **缺少模板**：没有标准化的文档模板
4. **版本管理缺失**：文档更新历史不明确

## 二、改造方案

### 2.1 创建项目配置文件

创建 `/docs/config/project.config.json`：

```json
{
  "project": {
    "name": "${PROJECT_NAME}",
    "displayName": "${PROJECT_DISPLAY_NAME}",
    "version": "${PROJECT_VERSION}",
    "description": "${PROJECT_DESCRIPTION}"
  },
  "organization": {
    "name": "${ORG_NAME}",
    "team": "${TEAM_NAME}",
    "website": "${ORG_WEBSITE}",
    "github": "${GITHUB_URL}"
  },
  "deployment": {
    "production": {
      "domain": "${PRODUCTION_DOMAIN}",
      "apiUrl": "${PRODUCTION_API_URL}"
    },
    "staging": {
      "domain": "${STAGING_DOMAIN}",
      "apiUrl": "${STAGING_API_URL}"
    },
    "local": {
      "port": "${LOCAL_PORT}",
      "url": "http://localhost:${LOCAL_PORT}"
    }
  },
  "payment": {
    "providers": {
      "primary": "${PRIMARY_PAYMENT_PROVIDER}",
      "secondary": "${SECONDARY_PAYMENT_PROVIDER}"
    },
    "webhooks": {
      "success": "${PAYMENT_SUCCESS_URL}",
      "cancel": "${PAYMENT_CANCEL_URL}",
      "notify": "${PAYMENT_NOTIFY_URL}"
    }
  },
  "documentation": {
    "baseUrl": "${DOCS_BASE_URL}",
    "apiDocs": "${API_DOCS_URL}",
    "lastUpdated": "${LAST_UPDATED}",
    "maintainer": "${MAINTAINER}"
  }
}
```

### 2.2 文档重组方案

```
docs/
├── 00-索引/
│   └── 文档目录.md
├── 01-快速开始/
│   ├── 项目介绍.md
│   ├── 环境配置.md
│   └── 快速上手.md
├── 02-架构设计/
│   ├── 系统架构.md
│   ├── 技术栈说明.md
│   └── 数据库设计.md
├── 03-功能文档/
│   ├── 用户认证.md
│   ├── 支付系统.md
│   ├── AI生成功能.md
│   └── 归因系统.md
├── 04-开发指南/
│   ├── 代码规范.md
│   ├── 开发流程.md
│   ├── 测试指南.md
│   └── Claude自动化.md
├── 05-部署运维/
│   ├── 部署指南.md
│   ├── 环境变量.md
│   ├── 性能优化.md
│   └── 故障排查.md
├── 06-产品文档/
│   ├── 产品需求.md
│   ├── 用户手册.md
│   └── 会员体系.md
├── 07-集成配置/
│   ├── 支付配置/
│   │   ├── Stripe配置.md
│   │   └── 通用支付配置.md
│   ├── AI提供商/
│   │   ├── OpenAI配置.md
│   │   ├── SiliconFlow配置.md
│   │   └── OpenRouter配置.md
│   └── 第三方服务/
│       ├── MCP配置.md
│       └── Context7配置.md
├── 08-迁移升级/
│   ├── NextJS15迁移.md
│   └── 版本升级指南.md
├── config/
│   ├── project.config.json
│   └── templates/
│       ├── 文档模板.md
│       ├── API文档模板.md
│       └── 故障报告模板.md
└── scripts/
    ├── replace-variables.js
    └── validate-docs.js
```

### 2.3 具体修改对照表

#### Before/After 对比

##### 1. nextjs15-migration-guide.md
```markdown
<!-- BEFORE -->
- **项目**: Mahavatar Narsimha (MovieIndia)
const baseUrl = 'https://mahavatar-narsimha.com'

<!-- AFTER -->
- **项目**: {{PROJECT_DISPLAY_NAME}}
const baseUrl = process.env.NEXT_PUBLIC_WEB_URL || '{{PRODUCTION_DOMAIN}}'
```

##### 2. 支付配置文档
```markdown
<!-- BEFORE -->
Webhook URL: https://{{PRODUCTION_DOMAIN}}/api/pay/notify/creem
Success URL: https://{{PRODUCTION_DOMAIN}}/pay-success

<!-- AFTER -->
Webhook URL: {{PRODUCTION_DOMAIN}}/api/pay/notify/{{PAYMENT_PROVIDER}}
Success URL: {{PRODUCTION_DOMAIN}}/pay-success
```

##### 3. 团队信息
```markdown
<!-- BEFORE -->
*维护者：AI ShipAny Team*
*维护者：AI Universal Generator Team*

<!-- AFTER -->
*维护者：{{TEAM_NAME}}*
*最后更新：{{LAST_UPDATED}}*
```

### 2.4 文档模板化

#### 基础文档模板 (`/docs/config/templates/文档模板.md`)
```markdown
# {{DOCUMENT_TITLE}}

## 概述
{{DOCUMENT_OVERVIEW}}

## 适用版本
- **项目版本**: {{PROJECT_VERSION}}
- **更新日期**: {{LAST_UPDATED}}
- **维护者**: {{MAINTAINER}}

## 目录
[自动生成]

## 主要内容
{{MAIN_CONTENT}}

## 相关文档
- [链接到其他文档]

## 更新历史
| 版本 | 日期 | 修改内容 | 修改者 |
|------|------|----------|--------|
| v1.0 | {{DATE}} | 初始版本 | {{AUTHOR}} |

---
*本文档由 {{TEAM_NAME}} 维护*
*项目地址: {{GITHUB_URL}}*
```

### 2.5 国际化策略

#### 文档i18n结构
```
docs/
├── zh-CN/  # 中文文档（主要）
│   └── [所有中文文档]
├── en/     # 英文文档
│   └── [英文翻译版本]
└── i18n/
    ├── glossary.json  # 术语对照表
    └── translation-guide.md  # 翻译指南
```

#### 术语对照表 (`/docs/i18n/glossary.json`)
```json
{
  "terms": {
    "会员体系": "Membership System",
    "归因系统": "Attribution System",
    "支付配置": "Payment Configuration",
    "代码规范": "Code Standards"
  }
}
```

## 三、实施步骤

### 第一阶段：紧急修复（立即执行）
1. ✅ 移除所有硬编码的项目名称
2. ✅ 替换特定域名为占位符
3. ✅ 创建项目配置文件

### 第二阶段：结构重组（1周内）
1. ⏳ 按新结构重组文档
2. ⏳ 统一文档命名（全部中文）
3. ⏳ 创建文档模板

### 第三阶段：自动化改进（2周内）
1. ⏳ 实现变量替换脚本
2. ⏳ 添加文档验证工具
3. ⏳ 建立文档更新流程

## 四、变量替换脚本

创建 `/docs/scripts/replace-variables.js`：

```javascript
#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

// 加载配置
const config = require('../config/project.config.json');

// 环境变量映射
const envMapping = {
  PROJECT_NAME: process.env.PROJECT_NAME || 'AI Universal Generator',
  PROJECT_DISPLAY_NAME: process.env.PROJECT_DISPLAY_NAME || 'AI 通用生成器',
  PRODUCTION_DOMAIN: process.env.NEXT_PUBLIC_WEB_URL || 'https://{{PRODUCTION_DOMAIN}}',
  TEAM_NAME: process.env.TEAM_NAME || 'Development Team',
  // ... 更多映射
};

// 递归处理文档
function processDocuments(dir) {
  const files = fs.readdirSync(dir);
  
  files.forEach(file => {
    const filePath = path.join(dir, file);
    const stat = fs.statSync(filePath);
    
    if (stat.isDirectory() && !file.startsWith('.')) {
      processDocuments(filePath);
    } else if (file.endsWith('.md')) {
      replaceVariables(filePath);
    }
  });
}

// 替换变量
function replaceVariables(filePath) {
  let content = fs.readFileSync(filePath, 'utf8');
  
  // 替换所有 {{VARIABLE}} 格式的占位符
  Object.entries(envMapping).forEach(([key, value]) => {
    const regex = new RegExp(`{{${key}}}`, 'g');
    content = content.replace(regex, value);
  });
  
  fs.writeFileSync(filePath, content, 'utf8');
  console.log(`✅ Processed: ${filePath}`);
}

// 执行
console.log('🚀 Starting document variable replacement...');
processDocuments(path.join(__dirname, '..'));
console.log('✨ Document processing complete!');
```

## 五、建议的环境变量配置

在 `.env.example` 中添加：

```bash
# === 项目配置 ===
PROJECT_NAME="ai-universal-generator"
PROJECT_DISPLAY_NAME="AI通用生成器"
PROJECT_VERSION="2.6.0"
TEAM_NAME="您的团队名称"
ORG_NAME="您的组织名称"

# === 文档配置 ===
DOCS_BASE_URL="https://docs.{{PRODUCTION_DOMAIN}}"
API_DOCS_URL="https://api-docs.{{PRODUCTION_DOMAIN}}"
GITHUB_URL="https://github.com/{{ORG_NAME}}/{{REPO_NAME}}"

# === 支付配置（示例） ===
PRIMARY_PAYMENT_PROVIDER="stripe"
SECONDARY_PAYMENT_PROVIDER="custom"
PAYMENT_SUCCESS_URL="${NEXT_PUBLIC_WEB_URL}/pay-success"
PAYMENT_CANCEL_URL="${NEXT_PUBLIC_WEB_URL}/pricing?cancelled=true"
PAYMENT_NOTIFY_URL="${NEXT_PUBLIC_WEB_URL}/api/pay/notify"
```

## 六、自动化CI/CD集成

### GitHub Actions 配置
```yaml
name: Documentation Build
on:
  push:
    paths:
      - 'docs/**'
      
jobs:
  build-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Replace Variables
        run: |
          cd docs
          npm run replace-vars
          
      - name: Validate Documentation
        run: |
          cd docs
          npm run validate
```

## 七、预期效果

### 通用化后的优势
1. **🔄 可复用性**: 文档可直接用于其他项目
2. **⚙️ 配置化**: 通过配置文件管理项目特定信息
3. **🌍 国际化**: 支持多语言文档
4. **📝 标准化**: 统一的文档模板和结构
5. **🤖 自动化**: 变量替换和验证自动化

### 风险控制
1. 保留原始文档备份
2. 分阶段实施，避免一次性大改
3. 建立review机制
4. 添加文档测试

## 八、后续维护建议

1. **定期审查**: 每月检查新增硬编码
2. **模板更新**: 根据需求更新文档模板
3. **自动化检测**: CI中添加硬编码检测
4. **版本管理**: 使用Git标签管理文档版本

---

*创建日期: 2025-01-27*  
*文档版本: v1.0*  
*状态: 待实施*